<script src="/assets/jquery.js"></script>
<script src="/assets/reviews.js"></script>


<%= link_to "Customer details", user_profile_admin_reports_path%><br/>
<%= link_to "Industry Level Totals", industry_admin_reports_path%><br/>
<%= link_to "Company/Supplier Level Totals", company_admin_reports_path%><br/>

<%= link_to "Download Industry xls", industry_xls_admin_reports_path%><br/>
<%= link_to "Download Company/Supplier xls", company_xls_admin_reports_path%><br/>
<%= link_to "Download Total reviews xls", total_xls_admin_reports_path%><br/>
<%= link_to "Download Most complaints/compliments xls",most_company_xls_admin_reports_path%><br/>
<%= link_to "Download List Of Registered Suppliers xls", registered_company_xls_admin_reports_path%><br/>
<%= link_to "Download List Of Unregistered Suppliers xls",unregistered_company_xls_admin_reports_path%><br/>

<%= link_to "Archive Data",archive_data_admin_reports_path%><br/>
<br/><br/>


<table>
<%= form_for :report, :url=> admin_reports_path, :method => :get do |f| %>
  <h2>Filter Data</h2>
    <tr>
    <td>Industry</td>
    <td><span class="controls">
      <%= f.select :industry_name_eq, Industry.find(:all).map{|s| [s.title, s.id]}, {:prompt => "Select Industry"}%>
      </span>
    </td>
    <td>Company</td>
    <td><span class="controls">
      <%= f.select :company_name_eq, Company.find(:all).map{|s| [s.title, s.id]}, {:prompt => "Select Company"}%>
      </span>
    </td>
  </tr>
  <tr>
    <td>Town</td>
    <td><span class="controls">
      <%= f.select :town_name_eq, Town.find(:all).map{|s| [s.title, s.id]}, {:prompt => "Select Town"}%>
      </span>
    </td>
    <td>Location</td>
    <td><span class="controls">
      <%= f.select :location_name_eq, Location.find(:all).map{|s| [s.title, s.id]}, {:prompt => "Select Location"}%>
      </span>
    </td>
    
   </tr>
   <tr>
     <td>Review Type</td>
   	 <td><%= f.select :review_type, (options_for_select([['Select Review Type', ''],['Compliment', 'compliment'], ['Complaint', 'complaint']],selected: :review_type))%></td>
   </tr>
   <tr>
   	 <td>Nature of Review (Compliment)</td>
   	 <td><%= f.select :nature_of_review_eq, NatureOfReview.where('review_type = ?', 'compliment').map{|s| [s.title, s.title]}, {:prompt => "Select Location"},:onclick=>"Checkpop(this.form)"%></td>

     <td>Nature of Review (Complaint)</td>
   	 <td><%= f.select :nature_of_review_eq, NatureOfReview.where('review_type = ?', 'complaint').map{|s| [s.title, s.title]}, {:prompt => "Select Location"},:onclick=>"Checkpop(this.form)"%></td>

   </tr>
   <td><%= button_tag  :submit ,name:"subaction",value: "update",:class => "btn btn btn-primary" %></td>
   
<%end%>
</table>
<br/><br/>

<%if params[:subaction] == "update"%>
<%#= link_to "Archive Data",archive_data_admin_reports_path(:id => "xls")%>
<%= link_to "Download Filter Data", admin_reports_path(params.merge(format: "xls")), :method=> :get, :class=>"btn btn-secondary" %>
<h4>Reviews</h4>

<table id="admin_review_xls" >
	<thead>
	  <tr>
			<th width="10%">Date</th>
			<th width="15%">Ticket Number</th>
			<th width="10%">Review</th>
			<th width="15%">Company</th>
			<th width="15%">Title</th>
	        <th width="15%">Customer Name</th>
	  </tr>
	</thead>

	<tbody>
	  <% @reviews.each do |review| %>
	    <tr>
				<td><%=review.date_time rescue nil %></td>
				<td><%=review.ticket_number rescue nil %></td>
				<td><%=review.review_type.titleize rescue nil %></td>
				<td><%=review.company.title.titleize rescue nil %></td>
				<td><%=review.title.titleize rescue nil %></td>
			    <td><%=review.try(:user).try(:full_name)%></td>
	    </tr>
	  <% end %>
	</tbody>	
</table>
<%end%>



<h1>Totals â€“ over a 12 month period</h1>
<table border="1">
	<thead>
		<tr>
			<th>Total Reviews</th>
		</tr>

	</thead>

	<tbody>
		<tr>
			<td>Compliments</td>
			<td><%= @compliments%></td>
		</tr>
		<tr>
			<td>Complaint</td>
			<td><%= @complaints%></td>
		</tr>
		<tr>
			<td><strong>Total</strong></td>
			<td><%= @complaints + @compliments%></td>
		</tr>

	</tbody>
</table>

<br/><br/>
<table border="1">
	<thead>
		<tr>
			<th>Nature of Compliment</th>
		</tr>

	</thead>

	<tbody>
		<tr>
			<td>Billing/accounts</td>
			<td><%= @billing%></td>
		</tr>
		<tr>
			<td>Booking</td>
			<td><%= @booking%></td>
		</tr>
		<tr>
			<td>Call centre efficiency</td>
			<td><%= @call_center%></td>
		</tr>
		<tr>
			<td>Contract</td>
			<td><%= @contract%></td>
		</tr>
		<tr>
			<td>Delivery on time</td>
			<td><%= @delivery%></td>
		</tr>
		<tr>
			<td>Feedback</td>
			<td><%= @feedback%></td>
		</tr>
		<tr>
			<td>Going the extra mile</td>
			<td><%= @going_extra%></td>
		</tr>
		<tr>
			<td>Great attitude</td>
			<td><%= @great_attitude%></td>
		</tr>
		<tr>
			<td>Pricing</td>
			<td><%= @pricing%></td>
		</tr>
		<tr>
			<td>Refund</td>
			<td><%= @refund%></td>
		</tr>
		<tr>
			<td>Repairs</td>
			<td><%= @repairs%></td>
		</tr>
		<tr>
			<td>Stock</td>
			<td><%= @stock%></td>
		</tr>
		<tr>
			<td>Other</td>
			<td><%= @others%></td>
		</tr>

	</tbody>
</table>
<br/><br/>


<table border="1">
	<thead>
		<tr>
			<th>Nature of Complaints</th>
		</tr>

	</thead>

	<tbody>
		<tr>
			<td>Billing/accounts</td>
			<td><%= @billing_c%></td>
		</tr>
		<tr>
			<td>Booking</td>
			<td><%= @booking_c%></td>
		</tr>
		<tr>
			<td>Call centre efficiency</td>
			<td><%= @call_center_c%></td>
		</tr>
		<tr>
			<td>Contract</td>
			<td><%= @contract_c%></td>
		</tr>
		<tr>
			<td>Delivery on time</td>
			<td><%= @delivery_c%></td>
		</tr>
		<tr>
			<td>Feedback</td>
			<td><%= @feedback_c%></td>
		</tr>
		<tr>
			<td>Going the extra mile</td>
			<td><%= @going_extra_c%></td>
		</tr>
		<tr>
			<td>Great attitude</td>
			<td><%= @great_attitude_c%></td>
		</tr>
		<tr>
			<td>Pricing</td>
			<td><%= @pricing_c%></td>
		</tr>
		<tr>
			<td>Refund</td>
			<td><%= @refund_c%></td>
		</tr>
		<tr>
			<td>Repairs</td>
			<td><%= @repairs_c%></td>
		</tr>
		<tr>
			<td>Stock</td>
			<td><%= @stock_c%></td>
		</tr>
		<tr>
			<td>Other</td>
			<td><%= @others_c%></td>
		</tr>

	</tbody>
</table>

<script type="text/javascript">



	function Checkpop(f){
        var a = document.getElementById('report_nature_of_review_eq').value
        var b = document.getElementById('report_review_type').value
        //alert(a != null);
         
        if(a == null && b != null)
            {

               alert("Your application will be sent to company for approval, will contact you via email. To follow up call (800) 921-1008 or email WFleischer@bfbond.com . Thank you and please PROCEED with the application.");
            }
         
    };
  

</script>