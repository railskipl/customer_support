<%if params[:subaction] == "conversion_company" %>
<strong>Displaying data for duration <%= @start_from%> to <%= @start_to%>
<%else%>
  <strong>Displaying data for 12 Months</strong>
<%end%> 
<table id="industry_conversion">
  <thead>
    <tr>
      <th>Company</th>
      <th>Total Complaints Count</th>
      <th>Complaint --> Compliment</th>
      <th>Conversion Percentage</th>
    </tr>
  </thead>

  <tbody>
    <% @companies.each do |company| %>
    <% @compliment = Review.where('created_at >= ? and created_at <= ? and company_id = ? and user_id is not null', @start_from, @start_to, company.id)%>
    
    <% @complaint_conversion = @compliment.where('review_type = ?', 'complaint').count%>
      
    <% @compliments = @compliment.where('change_date is not null').count%> 
      <tr>
        <td><%=company.title rescue nil %></td>
        <td><%=@complaint_conversion + @compliments rescue nil %></td>
        <td><%=@compliments rescue nil %></td>
        <% @a = @complaint_conversion + @compliments %>
        <% @percentage =  @compliments / @a * 100 rescue nil%>
        <%unless @percentage.present?%>
          <td>0</td>
        <%else%>
          <td><%= @percentage rescue nil%>%</td>
        <%end%>
      </tr>
    <%end%>
  </tbody>  
</table>

<br/><br/>